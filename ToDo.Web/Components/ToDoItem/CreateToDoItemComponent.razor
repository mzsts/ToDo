@page "/createtodoitem"
@page "/createtodosubitem/{parentId:int}"

@inject IDbContextFactory<ToDoDbContext> ContextFactory

@if(ParentId == 0)
{
    <ToDoItemEditForm IsCreation="true" Item="item" Parent="parent"></ToDoItemEditForm>
}
else
{
    @if(parent is null && ParentId != 0)
    {
        <MudProgressCircular Color="Color.Info" Size="Size.Large" Indeterminate="true" />
    }
    else
    {
        <ToDoItemEditForm IsCreation="true" Item="item" Parent="parent"></ToDoItemEditForm>
    }
}


@code {
    [Parameter]
    public int ParentId { get; set; }

    private ToDoItem item = new();
    private ToDoItem parent = null;

    protected override async Task OnInitializedAsync()
    {
        using(var context = ContextFactory.CreateDbContext())
        {
            if(ParentId != 0)
            {
                parent = await context.ToDoItems.FirstOrDefaultAsync(item => item.Id == ParentId);
            }
        }

        await base.OnInitializedAsync();
    }
}
